# Prompt v5.0: Current State Summary

**Date:** December 2024  
**Status:** Production (live in deep-reasoning.ts)  
**Model:** Gemini 2.0 Flash  

---

## ðŸ“Š Current Performance Metrics

| Metric | Score | Target |
|--------|-------|--------|
| LLM-as-Judge Overall | 82.5% | 85%+ |
| Mechanism Match | 88.5% | 90%+ |
| Key Insight Captured | 69.2% | 80%+ |
| Avg Embedding Similarity | 55.9% | 70%+ |
| Videos Below 60% Similarity | 80 | <20 |

---

## ðŸ”§ Prompt Architecture

### Location
- **Live Code:** `src/lib/services/video/deep-reasoning.ts`
- **Prompt Start:** Line ~20 (DEEP_REASONING_CHAIN constant)
- **Seed Examples:** Line ~518+ (SEED_DEEP_REASONING_EXAMPLES array)

### The 9-Step Deep Reasoning Chain

```
STEP 1: CHARACTER DYNAMICS
   â†’ Who is interacting? What are their roles/power positions?

STEP 2: UNDERLYING TENSION  
   â†’ What's the real conflict beneath the surface?

STEP 3: FORMAT PARTICIPATION
   â†’ Does the video format itself become part of the joke?

STEP 4: EDITING AS COMEDY
   â†’ How do cuts, timing, and visual elements contribute?

STEP 5: AUDIENCE SURROGATE
   â†’ Who does the audience identify with?

STEP 6: SOCIAL DYNAMICS & CRUELTY
   â†’ Is someone being embarrassed? Is there mean humor?

STEP 7: CONTENT QUALITY ASSESSMENT
   â†’ Rate: [GOOD], [MEDIOCRE], or [BAD]

STEP 8: SELF-PERCEPTION GAP
   â†’ Does a character's self-image differ from reality?

STEP 9: SYNTHESIS
   â†’ Combine insights into coherent interpretation
```

---

## ðŸ“š Seed Examples (17 total)

### Original 9 Examples (v4.0)
| # | Concept | Tags |
|---|---------|------|
| 1 | Lamb chops - format subversion | incentive-conflict, rebel-worker |
| 2 | POV tipping - misdirection | pov-misdirection, power-dynamic |
| 3 | Use your heads - malicious compliance | workplace-resistance, escalation |
| 4 | Shake it - self-perception gap | misunderstanding, literal-vs-intended |
| 5 | Generosity game - social ritual | generosity-game, dating-dynamics |
| 6 | Finish this - ambiguous phrasing | ambiguous-phrasing, reaction-punchline |
| 7 | 4-year-old chef - expression reversal | literal-truth-reveal, wholesome |
| 8 | Do you work here - sarcasm | sarcasm-as-correction, obvious-question |
| 9 | Beauty discount - mean humor | implied-rejection, casual-cruelty |

### New v5.0 Examples (8 added)
| # | Concept | Gap Targeted |
|---|---------|--------------|
| 10 | Kitchen bell - absurdist exaggeration | CULTURAL_CONTEXT |
| 11 | Pregnancy cravings - cultural exception | CULTURAL_CONTEXT |
| 12 | Child negotiating - generational humor | CULTURAL_CONTEXT |
| 13 | Waiting for coworker - thin premise | QUALITY_MISJUDGED |
| 14 | Coffee questions - flat execution | QUALITY_MISJUDGED |
| 15 | Dry wine - surface pun | QUALITY_MISJUDGED |
| 16 | Pig edit - visual-dependent | VISUAL_REVEAL |
| 17 | Selfie reveal - visual payoff | VISUAL_REVEAL |

---

## ðŸŽ¯ Known Gaps (from question_battery.json)

| Gap Type | Count | Status |
|----------|-------|--------|
| CULTURAL_CONTEXT | 57 | Addressed with 3 new examples |
| QUALITY_MISJUDGED | 31 | Addressed with 3 new examples |
| SOCIAL_DYNAMICS | 28 | Partially covered in original examples |
| VISUAL_REVEAL | 21 | Addressed with 2 new examples |
| FORMAT_SUBVERSION | 3 | Well covered in original examples |
| SUBTLE_ELEMENTS | 2 | Low priority |
| MECHANISM_WRONG | 1 | Low priority |

---

## ðŸ”„ Iteration Workflow

### To Add New Examples

1. **Find a failing video** from `video_analysis_examples` with a human correction
2. **Identify the gap type** (what did AI miss?)
3. **Write a structured example** following the format in SEED_DEEP_REASONING_EXAMPLES
4. **Add to deep-reasoning.ts** after the existing examples
5. **Re-run evaluation** to verify improvement

### To Evaluate Changes

```bash
# Generate evaluation dataset
npm run scripts/generate-question-battery.js

# Run LLM-as-Judge comparison  
npm run scripts/llm-judge-comparison.js

# Check embedding similarity
npm run scripts/compute-understanding-scores.js
```

---

## ðŸ“ Key Files Reference

| File | Purpose |
|------|---------|
| `src/lib/services/video/deep-reasoning.ts` | Live prompt + seed examples |
| `src/lib/services/video/gemini.ts` | Gemini API integration |
| `src/lib/services/video/learning.ts` | RAG retrieval system |
| `datasets/question_battery.json` | Evaluation dataset with gaps |
| `docs/QUICK_CONTEXT.md` | Fast context recovery for agents |

---

## âš¡ Key Learnings from v4.0 â†’ v5.0

### What Works Well
- 9-step reasoning chain forces structured analysis
- Self-perception gap detection catches many subtle misses
- Mean humor and social dynamics now better recognized

### Still Struggling
- **CULTURAL_CONTEXT:** AI doesn't always know cultural references (pregnancy cravings, kitchen hierarchy, generational play)
- **QUALITY_MISJUDGED:** AI calls everything "funny" - needs calibration on MEDIOCRE/BAD ratings
- **VISUAL_REVEAL:** AI describes dialogue but misses that the EDIT is the punchline

### Architectural Insight
The prompt already has the right structure. The gap is in **examples** (showing the pattern) rather than **instructions** (telling what to do). Each failing pattern type needs 2-3 concrete examples that demonstrate the correct reasoning.

---

## ðŸš€ Next Steps

1. **Monitor new examples:** Do v5.0 additions improve scores?
2. **Add more SOCIAL_DYNAMICS examples** if still failing
3. **Consider STEP 10: CULTURAL KNOWLEDGE** as dedicated chain step
4. **Build automated regression tests** for known failing videos

---

## ðŸ“ Version History

| Version | Date | Key Changes |
|---------|------|-------------|
| v1.0 | Nov 2024 | Basic sigma taste prompt |
| v1.1 | Nov 2024 | Calibrated language |
| v3.5 | Dec 2024 | Humor teaching focus |
| v4.0 | Dec 2024 | 9-step deep reasoning chain |
| v5.0 | Dec 2024 | +8 examples for CULTURAL, QUALITY, VISUAL gaps |
